/*! tetris v1.0 | (c) 2013 Adam Jeffries | https://github.com/JeffriesCo/TetrisJS/blob/master/LICENSE */
(function(e){var t={};var n=null;var r=0;var i=0;var s=0;var o=20;var u=10;var a=false;var f=[40,100,300,1200];var l=[800,720,640,560,480,420,360,300,240,200,180,160,140,120,100,90,80,70,60,50];var c={row:0,col:0};var h={row:0,col:0};var p=null;var d=null;var v={I:[[false,false,false,false],[false,false,false,false],[true,true,true,true],[false,false,false,false]],T:[[false,false,false],[true,true,true],[false,true,false]],O:[[true,true],[true,true]],L:[[false,false,false],[true,true,true],[true,false,false]],J:[[false,false,false],[true,true,true],[false,false,true]],S:[[false,false,false],[false,true,true],[true,true,false]],Z:[[false,false,false],[true,true,false],[false,true,true]]};var m=function(){var e={};var n=null;var r={};var i=0;var s=0;e.start=function(){var t=this;var i=(new Date).getTime();if(n){return}n=setInterval(function(){var t=(new Date).getTime();var n=t-i;s+=n;for(var o in r){r[o].duration-=n;if(r[o].duration<=0){if(r[o].maxCycles&&r[o].maxCycles<=r[o].cycles){r[o].action(r[o].maxCycles);e.removeAction(o);continue}r[o].duration+=r[o].milli;r[o].action(r[o].cycles++)}}i=t},5);return e};e.stop=function(){clearInterval(n);n=null;return e};e.isRunning=function(){return n?true:false};e.addAction=function(e,n,i,s){r[e]={action:n,milli:i,duration:i,cycles:0,maxCycles:s?s:false};return t};e.removeAction=function(e){delete r[e]};e.reset=function(){for(var t in r){e.removeAction(t)}e.stop()};return e}();var g={};var y=function(e,n){g[e]=[];y[e]=function(){var t=n?n.apply(this,Array.prototype.slice.call(arguments)):Array.prototype.slice.call(arguments);for(var r=0;r<g[e].length;r++){g[e][r].apply(this,t)}};t["on"+e.charAt(0).toUpperCase()+e.slice(1)]=function(n){g[e].push(n);return t}};var b={type:"",minos:[]};y("move",function(){var e=[];for(var t=0;t<d.matrix.length;t++){for(var n=0;n<d.matrix[t].length;n++){if(d.matrix[t][n]&&t+c.row>=0&&t+c.row<o&&n+c.col>=0&&n+c.col<u){e.push({row:t+c.row,col:n+c.col})}}}var r={type:d.type,minos:e,prevType:b.type,prevMinos:b.minos};b={type:d.type,minos:e};return[r]});y("matrix",function(){return[n]});y("clearLines");y("levelUp");y("blockOut");var w={type:"",minos:[]};y("ghost",function(){var e=[];for(var t=0;t<d.matrix.length;t++){for(var n=0;n<d.matrix[t].length;n++){if(d.matrix[t][n]&&t+h.row>=0&&t+h.row<o&&n+h.col>=0&&n+h.col<u){e.push({row:t+h.row,col:n+h.col})}}}var r={type:d.type,minos:e,prevType:w.type,prevMinos:w.minos};w={type:d.type,minos:e};return[r]});y("pause");y("play");y("queue",function(){return[p]});var E=null;y("score",function(){var e=[r,E];E=r;return e});var S=function(){var e=["I","T","O","L","J","S","Z"];var t=e.length,n,r;while(--t){r=Math.floor(Math.random()*(t+1));n=e[t];e[t]=e[r];e[r]=n}return e[0]};var x=function(e){var t=[];for(var n=0;n<e.length;n++){t[n]=[];for(var r=0;r<e[n].length;r++){t[n][r]=e[n][r]}}return t};var T=function(e,t){var n=[];if(t){for(var r=0;r<e.length;r++){n[r]=[];for(var i=0;i<e.length;i++){n[r][i]=e[e.length-i-1][r]}}}else{for(var r=0;r<e.length;r++){n[r]=[];for(var i=0;i<e.length;i++){n[r][i]=e[i][e.length-r-1]}}}return n};var N=function(e,t){if(t>=0&&t<u&&e<o&&(e<0||n[e][t]=="")){return true}return false};var C=function(e,t){for(var n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++){if(e[n][r]&&!N(n+t.row,r+t.col)){return false}}}return true};var k=function(){for(var e=0;e<d.matrix.length;e++){for(var t=0;t<d.matrix[e].length;t++){if(d.matrix[e][t]&&e+c.row>=0&&e+c.row<o&&t+c.col>=0&&t+c.col<u&&N(e+c.row,t+c.col)){n[e+c.row][t+c.col]=d.type}}}y.matrix()};var L=function(){for(var e=0;e<d.matrix.length;e++){for(var t=0;t<d.matrix[e].length;t++){if(d.matrix[e][t]&&e+c.row<0){return true}}}return false};var A=function(){var e=c.row;var t=e+1;while(C(d.matrix,{row:t,col:c.col})){e=t;t++}return e};var O=function(){var e=A();if(e>c.row){h={row:e,col:c.col};y.ghost()}};var M=function(e){n.splice(e,1);n.unshift([]);for(var t=0;t<u;t++){n[0][t]=""}};var _=function(){var e=0;for(var t=0;t<100;t++){e+=Math.min(t*10,100);if(e>i){return t-1}}};var D=function(){var e=[];for(var t=0,o;t<n.length;t++){o=true;for(var u=0;u<n[t].length;u++){if(n[t][u]==""){o=false}}if(o){e.push(t)}}if(e.length>0){for(var a=0;a<e.length;a++){M(e[a])}r+=f[e.length-1]*(s+1);i+=e.length;y.score();y.clearLines(e,i,n);var l=_();if(l>s){B()}}};var P=function(){var e=S();var t={type:e,matrix:x(v[e])};b={type:"",minos:[]};w={type:"",minos:[]};if(a){d=t}else{d=p;p=t;y.queue()}c={row:d.matrix.length*-1,col:Math.floor((u-d.matrix.length)/2)};O();y.move()};var H=function(){var e={row:c.row+1,col:c.col};if(C(d.matrix,e)){c=e;y.move();r+=s+1}else if(L()){y.blockOut();m.reset()}else{y.score();k();D();P()}};var B=function(){m.removeAction("level"+s);s++;y.levelUp(s);m.addAction("level"+s,function(){H()},l[s]||50)};var j=function(e,n){t[e]=function(){n.apply(this,Array.prototype.slice.call(arguments));return t}};j("moveLeft",function(){if(!m.isRunning()){return}var e={row:c.row,col:c.col-1};if(C(d.matrix,e)){c=e;O();y.move()}});j("moveRight",function(){if(!m.isRunning()){return}var e={row:c.row,col:c.col+1};if(C(d.matrix,e)){c=e;O();y.move()}});j("hardDrop",function(){if(!m.isRunning()){return}c={row:A(),col:c.col};k();D();P()});j("softDrop",function(){if(!m.isRunning()){return}H()});j("rotateRight",function(){if(!m.isRunning()){return}var e=T(d.matrix,true);if(C(e,c)){d.matrix=e;O();y.move()}});j("rotateLeft",function(){if(!m.isRunning()){return}var e=T(d.matrix,false);if(C(e,c)){d.matrix=e;O();y.move()}});j("togglePause",function(){if(m.isRunning()){m.stop();y.pause()}else{m.start();y.play()}});j("toggleHold",function(){if(!m.isRunning()){return}a=!a});j("newGame",function(e){m.reset();r=0;i=0;s=e?e-1:-1;n=[];for(var t=0;t<o;t++){n[t]=[];for(var a=0;a<u;a++){n[t][a]=""}}y.matrix();var f=S();p={type:f,matrix:x(v[f])};B();P();m.start()});t.getScore=function(){return r};t.getLevel=function(){return s};t.getLines=function(){return i};t.getBoard=function(){return n};t.getTetriminoType=function(){return d.type};t.isOnHold=function(){return a};t.getTimer=function(){return m};window.tetris=t})()